import{u as F,s as U,k as q,D as T,l as b,E as B,y as R,z,o as c,c as r,e as O,d as t,I as J,t as i,F as S,j as G,m as _,Y,G as h,v,p as H,q as K,O as P}from"./index-e-kLE5WB.js";import{_ as g}from"./dashboard-icons-tCq6vBQ4.js";import{M as Q}from"./modal-FBL1wkSJ.js";import{_ as W}from"./LoadingUi-YdW-FvWX.js";import{_ as X}from"./DeleteModal-S5GZPLYd.js";import{u as Z}from"./order-4qRV4fQU.js";import{_ as tt}from"./plugin-vueexport-helper-x3n3nnut.js";const s=u=>(H("data-v-e96ffbeb"),u=u(),K(),u),st=g+"#fig-down",et=g+"#fig-pen",ot=g+"#fig-trash",lt={class:"row g-3 g-lg-4"},dt={class:"col-12 col-lg-2"},at={class:"list-group sticky-top",style:{top:"30px"}},nt=s(()=>t("button",{type:"button",class:"list-group-item list-group-item-action","aria-current":"true"}," 摘要 ",-1)),ct=s(()=>t("button",{type:"button",class:"list-group-item list-group-item-action"},"發票管理",-1)),rt=s(()=>t("button",{type:"button",class:"list-group-item list-group-item-action"},"危險操作",-1)),it={class:"col-12 col-lg-10"},ut={class:"card mb-3 mb-lg-4"},bt=s(()=>t("div",{class:"card-header border border-db-background-lighten"},[t("div",null,[t("h3",{class:"fs-6 text-db-netural lh-base mb-0"},"摘要"),t("span",{class:"text-db-netural-dark"},"包含訂單狀態等資訊。")])],-1)),_t={class:"card-body bg-db-background border border-top-0 border-db-background-lighten rounded-bottom-3"},mt={class:"row gy-1 mb-0"},pt=s(()=>t("dt",{class:"col-sm-2 text-db-netural text-nowrap"},"訂單編號 :",-1)),ht={class:"col-sm-10 text-db-netural-dark mb-1 mb-sm-2"},vt=s(()=>t("dt",{class:"col-sm-2 text-db-netural text-nowrap"},"訂單金額 :",-1)),gt={class:"col-sm-10 text-db-netural-dark mb-1 mb-sm-2"},ft=s(()=>t("dt",{class:"col-sm-2 text-db-netural text-nowrap"},"訂單狀態 :",-1)),yt=s(()=>t("dd",{class:"col-sm-10 text-db-netural-dark mb-1 mb-sm-2"},"待處理",-1)),xt=s(()=>t("dt",{class:"col-sm-2 text-db-netural text-nowrap"},"發票狀態 :",-1)),kt=s(()=>t("dd",{class:"col-sm-10 text-chart-red mb-0"},"未開立",-1)),wt={class:"card mb-3 mb-lg-4"},Ot={class:"card-header border border-db-background-lighten d-flex justify-content-between"},St=s(()=>t("h3",{class:"fs-6 text-db-netural lh-base mb-0"},"購買品項",-1)),$t={class:"text-db-netural-dark"},At=s(()=>t("div",null,[t("button",{type:"button",class:"btn btn-outline-netural","data-bs-toggle":"dropdown"},[t("span",{class:"d-none d-md-block me-2"},"出貨狀態處理"),t("svg",{width:"20",height:"20"},[t("use",{"xlink:href":st})])]),t("ul",{class:"dropdown-menu"},[t("li",null,[t("a",{class:"dropdown-item",href:"#"},"Action")]),t("li",null,[t("a",{class:"dropdown-item",href:"#"},"Another action")]),t("li",null,[t("a",{class:"dropdown-item",href:"#"},"Something else here")])])],-1)),It={class:"card-body table-responsive bg-db-background border-0"},Nt={class:"table table-db-background mb-0"},Ct=s(()=>t("thead",{class:"align-middle text-nowrap"},[t("tr",null,[t("th",{scope:"col",class:"fw-normal py-3 pe-3"}),t("th",{scope:"col",class:"fw-normal pe-3"},"貨號"),t("th",{scope:"col",class:"fw-normal pe-3"},"貨號"),t("th",{scope:"col",class:"fw-normal pe-3"},"購買價格"),t("th",{scope:"col",class:"fw-normal pe-3"},"訂購數量"),t("th",{scope:"col",class:"fw-normal text-end pe-3"},"出貨狀態"),t("th",{scope:"col",class:"fw-normal text-end pe-0"},"操作")])],-1)),Lt={class:"align-middle text-nowrap"},Et=s(()=>t("td",{scope:"row",class:"pt-3 pe-3 border-0"},[t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault"})],-1)),Mt={class:"pt-3 pe-3 border-0"},Dt={class:"pt-3 pe-3 border-0"},Vt={class:"pt-3 pe-3 border-0"},jt={class:"pt-3 pe-3 border-0 position-relative"},Ft={key:0},Ut=["onUpdate:modelValue"],qt=s(()=>t("td",{class:"pt-3 pe-3 border-0 text-end"},[t("span",{class:"tag tag-success"},"已出貨")],-1)),Tt={class:"pt-3 pe-0 border-0"},Bt={class:"d-flex justify-content-end"},Rt=["onClick"],zt=s(()=>t("svg",{width:"14",height:"14",class:"me-1"},[t("use",{"xlink:href":et})],-1)),Jt=s(()=>t("span",{class:"fs-9"},"編輯",-1)),Gt=[zt,Jt],Yt=["onClick"],Ht=s(()=>t("svg",{width:"14",height:"14",class:"me-1"},[t("use",{"xlink:href":ot})],-1)),Kt=s(()=>t("span",{class:"fs-9"},"刪除",-1)),Pt=[Ht,Kt],Qt={class:"card-footer bg-db-background rounded-bottom-3 d-flex justify-content-end pt-0"},Wt={class:"card mb-3 mb-lg-4"},Xt=s(()=>t("div",{class:"card-header border border-db-background-lighten"},[t("div",null,[t("h3",{class:"fs-6 text-db-netural lh-base mb-0"},"發票管理"),t("span",{class:"text-db-netural-dark"},"發票開立設定資訊。")])],-1)),Zt={class:"card-body bg-db-background border border-top-0 border-db-background-lighten rounded-bottom-3"},ts={class:"row align-items-center gy-1 mb-3 mb-sm-2"},ss=s(()=>t("label",{class:"col-sm-2 form-label text-db-netural mb-0"},"發票類型",-1)),es={class:"col-sm-10"},os=s(()=>t("option",{selected:"",disabled:""},"請選擇發票類型",-1)),ls=s(()=>t("option",{value:"個人發票"},"個人發票",-1)),ds=s(()=>t("option",{value:"公司統編"},"公司統編",-1)),as=[os,ls,ds],ns={class:"row align-items-center gy-1 mb-3 mb-sm-2"},cs=s(()=>t("label",{for:"bill-number",class:"col-sm-2 form-label text-db-netural mb-0"},"公司統編",-1)),rs={class:"col-sm-10"},is={class:"row align-items-center gy-1 mb-3 mb-sm-2"},us=s(()=>t("label",{for:"bill-name",class:"col-sm-2 form-label text-db-netural mb-0"},"公司名稱",-1)),bs={class:"col-sm-10"},_s={class:"card"},ms=s(()=>t("div",{class:"card-header border border-db-background-lighten"},[t("div",null,[t("h3",{class:"fs-6 text-db-netural lh-base mb-0"},"危險操作"),t("span",{class:"text-db-netural-dark"},"請務必確認後操作。")])],-1)),ps={class:"card-body bg-db-background border border-top-0 border-db-background-lighten rounded-bottom-3"},hs={class:"row align-items-center g-3"},vs=s(()=>t("div",{class:"col-5 col-sm-3 col-md-2"},[t("button",{type:"button",class:"btn btn-outline-netural d-block w-100"},"退款")],-1)),gs=s(()=>t("div",{class:"col-7 col-sm-9 col-md-10"},[t("span",{class:"text-db-netural-dark"},"退還客戶款項。")],-1)),fs={class:"col-5 col-sm-3 col-md-2"},ys=s(()=>t("div",{class:"col-7 col-sm-9 col-md-10"},[t("span",{class:"text-db-netural-dark"},"該筆訂單將刪除，包含相關訂單訊息。")],-1)),xs={__name:"AdminOrder",setup(u){const $=F(),{fetchDelAdminOrder:A,fetchUpdateAdminOrders:I}=P(),N=Z(),{tempOrder:C}=U(N),L=q(),{apiResAlert:f,apiErrAlert:y}=L,E=T(),{isLoadingOn:x,isLoadingOff:k}=E,o=b({}),M=B(()=>o.value.products?Object.keys(o.value.products).length:0),m=b(-1);function D(d){m.value=m.value===d?-1:d}R(()=>o.value,d=>{if(!d)return;let l=0;Object.entries(d.products).forEach(([e,a])=>{const n=a.qty*a.product.price;l+=n,o.value.products[e].total=n,o.value.products[e].final_total=n}),o.value.total=l},{deep:!0});async function V(d){x("isFullLoading");try{const l=await A(d);f(l.data.message),$.push("/admin/orders")}catch(l){const{data:e,status:a}=l.response;y(`${a} ${e.message}`)}finally{p.value.hide(),k("isFullLoading")}}async function j(d,l){x("isFullLoading");try{const e=await I(d,{data:l});f(e.data.message)}catch(e){const{data:a,status:n}=e.response;y(`${n} ${a.message}`)}finally{k("isFullLoading")}}const w=b(null),p=b({});return z(()=>{p.value=new Q(w.value.$el),o.value=JSON.parse(JSON.stringify(C.value))}),(d,l)=>(c(),r(S,null,[O(W),O(X,{ref_key:"delModalEl",ref:w,title:"刪除訂單",content:o.value.id,onDeleteEmit:l[0]||(l[0]=e=>V(o.value.id))},null,8,["content"]),t("div",lt,[t("div",dt,[t("div",at,[nt,t("button",{type:"button",class:J(["list-group-item list-group-item-action",{active:!0}])}," 購買品項 "),ct,rt])]),t("div",it,[t("div",ut,[bt,t("div",_t,[t("dl",mt,[pt,t("dd",ht,i(o.value.id),1),vt,t("dd",gt," NT$ "+i(o.value.total),1),ft,yt,xt,kt])])]),t("div",wt,[t("div",Ot,[t("div",null,[St,t("span",$t,"總計 "+i(M.value)+" 筆商品。",1)]),At]),t("div",It,[t("table",Nt,[Ct,t("tbody",Lt,[(c(!0),r(S,null,G(o.value.products,(e,a)=>(c(),r("tr",{key:e.id},[Et,t("td",Mt,i(e.product.num),1),t("td",Dt,i(e.product.title),1),t("td",Vt,"NT$ "+i(e.product.price),1),t("td",jt,[m.value!==a?(c(),r("span",Ft,i(e.qty)+" "+i(e.product.unit),1)):_((c(),r("input",{key:1,type:"number",min:"1",class:"form-control position-absolute py-0 pe-0","onUpdate:modelValue":n=>e.qty=n,style:{top:"19px",width:"60px"}},null,8,Ut)),[[v,e.qty,void 0,{number:!0}]])]),qt,t("td",Tt,[t("div",Bt,[t("button",{type:"button",class:"btn btn-primary me-1",onClick:n=>D(a)},Gt,8,Rt),t("button",{type:"button",class:"btn btn-danger",onClick:n=>delete o.value.products[a]},Pt,8,Yt)])])]))),128))])])]),t("div",Qt,[t("button",{type:"button",class:"btn btn-outline-netural",onClick:l[1]||(l[1]=e=>j(o.value.id,o.value))}," 儲存資料 ")])]),t("div",Wt,[Xt,t("div",Zt,[t("div",ts,[ss,t("div",es,[o.value.user?_((c(),r("select",{key:0,class:"form-select","aria-label":"Default select example","onUpdate:modelValue":l[2]||(l[2]=e=>o.value.user.billInfo.type=e)},as,512)),[[Y,o.value.user.billInfo.type]]):h("",!0)])]),t("div",ns,[cs,t("div",rs,[o.value.user?_((c(),r("input",{key:0,type:"number",class:"form-control",id:"bill-number",placeholder:"請輸入公司統一編號","onUpdate:modelValue":l[3]||(l[3]=e=>o.value.user.billInfo.billNumber=e)},null,512)),[[v,o.value.user.billInfo.billNumber]]):h("",!0)])]),t("div",is,[us,t("div",bs,[o.value.user?_((c(),r("input",{key:0,type:"text",class:"form-control",id:"bill-name",placeholder:"請輸入公司名稱","onUpdate:modelValue":l[4]||(l[4]=e=>o.value.user.billInfo.billName=e)},null,512)),[[v,o.value.user.billInfo.billName]]):h("",!0)])])])]),t("div",_s,[ms,t("div",ps,[t("div",hs,[vs,gs,t("div",fs,[t("button",{type:"button",class:"btn btn-outline-danger d-block w-100",onClick:l[5]||(l[5]=e=>p.value.show())}," 刪除訂單 ")]),ys])])])])])],64))}},Ns=tt(xs,[["__scopeId","data-v-e96ffbeb"]]);export{Ns as default};
