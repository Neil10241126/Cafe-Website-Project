import{k as fe,D as ge,l as p,E as O,z as K,_ as ve,r as ke,o as v,c as k,e as E,g as t,d as e,K as xe,t as a,I as C,f as x,m as F,v as U,X as ye,F as I,j as R,i as j,p as we,q as Ce,O as $e}from"./index-e-kLE5WB.js";import{_ as m}from"./dashboard-icons-tCq6vBQ4.js";import{M as Ae}from"./modal-FBL1wkSJ.js";import{_ as Ve}from"./LoadingUi-YdW-FvWX.js";import{_ as Se}from"./DeleteModal-S5GZPLYd.js";import{u as De}from"./useTimeformate-Oj4-TKDD.js";import{u as Ee,a as Fe}from"./useValidation--MndOpIM.js";import{_ as Le}from"./plugin-vueexport-helper-x3n3nnut.js";const d=$=>(we("data-v-549d46c4"),$=$(),Ce(),$),Me=m+"#fig-search",Pe=m+"#fig-reset",Ue=m+"#fig-undo",Ie=m+"#fig-filter",je=m+"#fig-pen",Ne=m+"#fig-trash",Be=m+"#fig-left",Te=m+"#fig-right",ze={class:"d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3 mb-lg-4",style:{position:"relative","z-index":"1"}},qe={class:"d-flex align-items-center mb-3 mb-md-0"},Oe={class:"text-db-netural-dark ms-3"},Ke=d(()=>e("div",{class:"input-group w-auto border border-2 border-db-netural-dark rounded-2"},[e("div",{class:"input-group-text bg-transparent border-0 p-2"},[e("svg",{width:"24",height:"24",class:"text-db-netural-dark"},[e("use",{"xlink:href":Me})])]),e("input",{type:"search",class:"form-control border-0",placeholder:"搜尋優惠券名稱"})],-1)),Re={class:"card bg-transparent mb-3 mb-lg-4"},We={class:"card-header d-flex justify-content-between border border-db-background-lighten px-lg-4"},Xe=d(()=>e("svg",{width:"24",height:"24"},[e("use",{"xlink:href":Pe})],-1)),Ge=d(()=>e("span",{class:"ms-2 d-none d-md-block"},"預設值",-1)),He=[Xe,Ge],Je={class:"d-flex align-items-center"},Qe=d(()=>e("button",{type:"button",class:"btn btn-outline-netural me-2"},[e("svg",{width:"24",height:"24"},[e("use",{"xlink:href":Ue})]),e("span",{class:"ms-2 d-none d-md-block"},"上一步")],-1)),Ye={width:"24",height:"24"},Ze=["xlink:href"],et={class:"ms-2 d-none d-md-block"},tt={class:"card-body border border-db-background-lighten border-top-0 rounded-bottom-2 px-lg-4"},st={class:"row row-cols-2 row-cols-lg-6 g-3 g-lg-4"},ot={class:"col"},nt={for:"name",class:"form-label text-db-netural-dark mb-3"},at={class:"fs-8 text-chart-red ms-1"},lt={class:"col"},dt={for:"discount",class:"form-label text-db-netural-dark mb-3"},it={class:"fs-8 text-chart-red ms-1"},rt={class:"col"},ct={for:"start-time",class:"form-label text-db-netural-dark mb-3"},ut={class:"fs-8 text-chart-red ms-1"},_t={class:"col"},pt={for:"end-time",class:"form-label text-db-netural-dark mb-3"},mt={class:"fs-8 text-chart-red ms-1"},ht={class:"col"},bt={for:"code",class:"form-label text-db-netural-dark mb-3"},ft={class:"fs-8 text-chart-red ms-1"},gt={class:"col"},vt={for:"isEnable",class:"form-label text-db-netural-dark mb-3"},kt={class:"fs-8 text-chart-red ms-1"},xt=d(()=>e("label",{for:"isEnable",class:"checkbox-switch"},null,-1)),yt={class:"card"},wt={class:"card-header d-flex justify-content-between px-md-4"},Ct=d(()=>e("h3",{class:"fs-6 text-db-netural lh-base mb-0"},"優惠券清單",-1)),$t={class:"text-db-netural-dark"},At=d(()=>e("div",{class:"d-flex align-items-center"},[e("button",{type:"button",class:"btn btn-outline-netural"},[e("svg",{width:"20",height:"20"},[e("use",{"xlink:href":Ie})]),e("span",{class:"d-none d-md-block ms-2"},"篩選")])],-1)),Vt={class:"card-body table-responsive px-md-4"},St={class:"table table-db-background-light"},Dt=d(()=>e("thead",{class:"align-middle text-nowrap"},[e("tr",null,[e("th",{scope:"col",class:"fw-normal py-3 pe-3"},"項次"),e("th",{scope:"col",class:"fw-normal pe-3"},"標題"),e("th",{scope:"col",class:"fw-normal pe-3"},"開始時間"),e("th",{scope:"col",class:"fw-normal pe-3"},"結束時間"),e("th",{scope:"col",class:"fw-normal pe-3"},"折扣 (%)"),e("th",{scope:"col",class:"fw-normal pe-3"},"代碼 (code)"),e("th",{scope:"col",class:"fw-normal text-end pe-3"},"是否啟用"),e("th",{scope:"col",class:"fw-normal text-end pe-0"},"操作")])],-1)),Et={class:"align-middle text-nowrap"},Ft={scope:"row",class:"pt-3 pe-3 border-0"},Lt={class:"pt-3 pe-3 border-0"},Mt={class:"pt-3 pe-3 border-0"},Pt={class:"pt-3 pe-3 border-0"},Ut={class:"pt-3 pe-3 border-0"},It={class:"pt-3 pe-3 border-0"},jt={class:"pt-3 pe-3 border-0 text-end"},Nt={class:"pt-3 pe-0 border-0"},Bt={class:"d-flex justify-content-end"},Tt=["onClick"],zt=d(()=>e("svg",{width:"14",height:"14",class:"me-1"},[e("use",{"xlink:href":je})],-1)),qt=d(()=>e("span",{class:"fs-9"},"編輯",-1)),Ot=[zt,qt],Kt=["onClick"],Rt=d(()=>e("svg",{width:"14",height:"14",class:"me-1"},[e("use",{"xlink:href":Ne})],-1)),Wt=d(()=>e("span",{class:"fs-9"},"刪除",-1)),Xt=[Rt,Wt],Gt={class:"card-footer bg-transparent border-top-0 px-md-4 d-flex justify-content-end"},Ht={"aria-label":"Page navigation example"},Jt={class:"pagination"},Qt={class:"page-item"},Yt=d(()=>e("svg",{width:"16",height:"16"},[e("use",{"xlink:href":Be})],-1)),Zt=[Yt],es=["onClick"],ts={class:"page-item"},ss=d(()=>e("svg",{width:"16",height:"16"},[e("use",{"xlink:href":Te})],-1)),os=[ss],ns={__name:"AdminCoupons",setup($){const{fetchAdminCoupons:W,fetchAddAdminCoupons:X,fetchUpdateAdminCoupons:G,fetchDeleteAdminCoupons:H}=$e(),{timeFormate:N}=De(),J=fe(),{apiResAlert:L,apiErrAlert:A}=J,Q=ge(),{isLoadingOn:V,isLoadingOff:S}=Q,{coupons:M,couponID:P,pagination:h,activeCoupons:Y,energyBarPercent:B,isNew:y,createAdminCoupn:Z,updateAdminCoupon:ee,deleteAdminCoupon:te}=se();function se(){const r=p([]),o=p(""),c=p({}),s=p(!0),n=O(()=>r.value.reduce((u,{is_enabled:l})=>u+l,0)),w=O(()=>(n.value/r.value.length*100).toFixed(0));async function D(u=1){V("isFullLoading");try{const{data:l}=await W(u);r.value=l.coupons,c.value=l.pagination}catch(l){const{data:_,status:b}=l.response;A(`${b} ${_.message}`)}finally{S("isFullLoading")}}async function pe(u){V("isFullLoading");try{const{data:l}=await X(u);L(l.message),D()}catch(l){const{data:_,status:b}=l.response;A(`${b} ${_.message}`)}finally{S("isFullLoading")}}async function me(u,l){V("isFullLoading");try{const{data:_}=await G(u,l);L(_.message),s.value=!0,D()}catch(_){const{data:b,status:be}=_.response;A(`${be} ${b.message}`)}finally{S("isFullLoading")}}async function he(u){V("isFullLoading");try{const{data:l}=await H(u);L(l.message),T.value.hide(),D()}catch(l){const{data:_,status:b}=l.response;A(`${b} ${_.message}`)}finally{S("isFullLoading")}}return K(()=>D()),{coupons:r,couponID:o,pagination:c,activeCoupons:n,energyBarPercent:w,isNew:s,createAdminCoupn:pe,updateAdminCoupon:me,deleteAdminCoupon:he}}const{delModalEl:oe,delModal:T,datePickerStart:ne,datePickerEnd:ae}=le();function le(){const r=p(null),o=p(""),c=p(null),s=p(null);return K(()=>{o.value=new Ae(r.value.$el);const n=c.value.$el.querySelector("input"),w=s.value.$el.querySelector("input");n.id="start-time",w.id="end-time"}),{delModalEl:r,delModal:o,datePickerStart:c,datePickerEnd:s}}const{addCouponSchema:de}=Ee(),{defineField:f,setValues:z,handleSubmit:ie,errors:g,meta:re}=Fe({validationSchema:de}),{tempCoupon:i,setUpdateValue:q,setDefaultValue:ce,onSubmit:ue}=_e();function _e(){const r=ve({title:f("title")[0],percent:f("percent")[0],start_date:f("start_date")[0],due_date:f("due_date")[0],code:f("code")[0],is_enabled:f("is_enabled")[0]});function o(n){P.value=n.id,z({title:n.title,percent:n.percent,start_date:n.start_date,due_date:n.due_date,code:n.code,is_enabled:n.is_enabled})}function c(){const n=new Date(new Date().setDate(new Date().getDate()+7)).getTime();z({title:"預設優惠券",percent:80,start_date:new Date().getTime(),due_date:n,code:"testCode",is_enabled:1}),y.value=!0}const s=ie((n,{resetForm:w})=>{y.value?Z({data:n}):ee(P.value,{data:n}),w()});return{tempCoupon:r,setUpdateValue:o,setDefaultValue:c,onSubmit:s}}return(r,o)=>{const c=ke("VueDatePicker");return v(),k(I,null,[E(Ve),E(Se,{ref_key:"delModalEl",ref:oe,title:"刪除優惠券",content:t(i).title,onDeleteEmit:o[0]||(o[0]=s=>t(te)(t(P)))},null,8,["content"]),e("div",ze,[e("div",qe,[e("div",{id:"energy-bar",style:xe({"--energy-bar-width":`${t(B)}%`})},a(t(Y))+"/ "+a(t(M).length),5),e("span",Oe,"啟用優惠券數量 "+a(t(B))+"%",1)]),Ke]),e("div",Re,[e("div",We,[e("button",{type:"button",class:"btn btn-outline-netural",onClick:o[1]||(o[1]=s=>t(ce)())},He),e("div",Je,[Qe,e("button",{type:"button",class:C(["btn btn-primary",{disabled:!t(re).valid}]),onClick:o[2]||(o[2]=s=>t(ue)())},[(v(),k("svg",Ye,[e("use",{"xlink:href":`/public/icons/dashboard-icons.svg#fig-${t(y)?"plus":"save"}`},null,8,Ze)])),e("span",et,a(t(y)?"新增優惠券":"儲存設定"),1)],2)])]),e("div",tt,[e("div",st,[e("div",ot,[e("label",nt,[x("標題 "),e("span",at,a(t(g).title),1)]),F(e("input",{type:"text",class:"form-control",id:"name",placeholder:"優惠券名稱","onUpdate:modelValue":o[3]||(o[3]=s=>t(i).title=s)},null,512),[[U,t(i).title]])]),e("div",lt,[e("label",dt,[x("折扣 (%) "),e("span",it,a(t(g).percent),1)]),F(e("input",{type:"number",min:"1",max:"99",class:"form-control",id:"discount",placeholder:"折扣百分比","onUpdate:modelValue":o[4]||(o[4]=s=>t(i).percent=s)},null,512),[[U,t(i).percent,void 0,{number:!0}]])]),e("div",rt,[e("label",ct,[x("開始時間 "),e("span",ut,a(t(g).start_date),1)]),E(c,{ref_key:"datePickerStart",ref:ne,"model-type":"timestamp",dark:!0,"enable-time-picker":!1,modelValue:t(i).start_date,"onUpdate:modelValue":o[5]||(o[5]=s=>t(i).start_date=s)},null,8,["modelValue"])]),e("div",_t,[e("label",pt,[x("結束時間 "),e("span",mt,a(t(g).due_date),1)]),E(c,{ref_key:"datePickerEnd",ref:ae,"model-type":"timestamp",dark:!0,"enable-time-picker":!1,modelValue:t(i).due_date,"onUpdate:modelValue":o[6]||(o[6]=s=>t(i).due_date=s)},null,8,["modelValue"])]),e("div",ht,[e("label",bt,[x("代碼 (code) "),e("span",ft,a(t(g).code),1)]),F(e("input",{type:"text",class:"form-control",id:"code",placeholder:"折扣優惠碼","onUpdate:modelValue":o[7]||(o[7]=s=>t(i).code=s)},null,512),[[U,t(i).code]])]),e("div",gt,[e("label",vt,[x("是否啟用 "),e("span",kt,a(t(g).is_enabled),1)]),e("div",null,[F(e("input",{type:"checkbox",class:"input-toggle",id:"isEnable","true-value":1,"false-value":0,"onUpdate:modelValue":o[8]||(o[8]=s=>t(i).is_enabled=s)},null,512),[[ye,t(i).is_enabled]]),xt])])])])]),e("div",yt,[e("div",wt,[e("div",null,[Ct,e("span",$t,"總計 "+a(t(M).length)+" 筆",1)]),At]),e("div",Vt,[e("table",St,[Dt,e("tbody",Et,[(v(!0),k(I,null,R(t(M),s=>(v(),k("tr",{key:s.id},[e("td",Ft,a(s.num),1),e("td",Lt,a(s.title),1),e("td",Mt,a(t(N)(s.start_date)),1),e("td",Pt,a(t(N)(s.due_date)),1),e("td",Ut,a(s.percent)+"%",1),e("td",It,a(s.code),1),e("td",jt,[e("span",{class:C(["tag tag-success",{"tag-danger":!s.is_enabled}])},a(s.is_enabled?"已啟用":"未啟用"),3)]),e("td",Nt,[e("div",Bt,[e("button",{type:"button",class:"btn btn-primary me-1",onClick:n=>(t(q)(s),y.value=!1)},Ot,8,Tt),e("button",{type:"button",class:"btn btn-danger",onClick:n=>(t(T).show(),t(q)(s))},Xt,8,Kt)])])]))),128))])])]),e("div",Gt,[e("nav",Ht,[e("ul",Jt,[e("li",Qt,[e("a",{class:C(["page-link",{disabled:!t(h).has_pre}]),href:"#","aria-label":"Previous",onClick:o[9]||(o[9]=j(s=>r.getAdminCoupons(t(h).current_page-1),["prevent"]))},Zt,2)]),(v(!0),k(I,null,R(t(h).total_pages,s=>(v(),k("li",{key:s+"123",class:"page-item"},[e("a",{class:C(["page-link",[{active:s===t(h).current_page},{disabled:s===t(h).current_page}]]),href:"#",onClick:j(n=>r.getAdminCoupons(s),["prevent"])},a(s),11,es)]))),128)),e("li",ts,[e("a",{class:C(["page-link",{disabled:!t(h).has_next}]),href:"#","aria-label":"Next",onClick:o[10]||(o[10]=j(s=>r.getAdminCoupons(t(h).current_page+1),["prevent"]))},os,2)])])])])])],64)}}},ps=Le(ns,[["__scopeId","data-v-549d46c4"]]);export{ps as default};
