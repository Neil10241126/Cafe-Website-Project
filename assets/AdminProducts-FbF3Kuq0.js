import{l as _,y as Ke,o as y,c as x,d as e,m as f,I as _e,D as w,i as ae,p as me,q as fe,k as Oe,E as qe,z as de,G as ce,e as re,g as t,f as p,F as ie,j as ue,t as l,v as A,K as v,L as b,X as Je,N as We}from"./index-9oBsyWac.js";import{_ as I}from"./icons-ZEDulI2G.js";import{u as Xe,a as He}from"./useValidation-l1eKhX1E.js";import{M as pe}from"./modal-_iWSQrNB.js";import{_ as he}from"./plugin-vueexport-helper-x3n3nnut.js";import{_ as Qe}from"./LoadingUi-eALphj39.js";const ge=U=>(me("data-v-19373216"),U=U(),fe(),U),Ye=I+"#plus",Ze=I+"#trash3",et={width:"36",height:"36",class:"img-icons"},tt=ge(()=>e("use",{"xlink:href":Ye},null,-1)),st=[tt],ot={class:"tool-list"},at=ge(()=>e("svg",{width:"24",height:"24"},[e("use",{"xlink:href":Ze})],-1)),it=[at],lt={__name:"UploaderUi",emits:["sendImageData","removeImageData"],setup(U,{emit:Q}){const m=_(null),P=_(null),h=_({isUploaded:!1,viewLink:"",fileName:"",fileSize:0,fileType:"",data:{}}),L=Q;function M(){if(m.value.files.length){const{name:S,size:r,type:$}=m.value.files[0];h.value={isUploaded:!0,viewLink:URL.createObjectURL(m.value.files[0]),fileName:S,fileSize:r,fileType:$.split("/").pop(),data:m.value.files[0]},P.value.style.backgroundImage=`url(${h.value.viewLink})`}}function Y(S){const{type:r}=S.dataTransfer.files[0];r.split("/").shift()==="image"&&(m.value.files=S.dataTransfer.files,M())}function Z(){m.value={},h.value={isUploaded:!1,viewLink:"",fileName:"",fileSize:0,fileType:"",data:{}},P.value.style.backgroundImage="",L("removeImageData")}return Ke(h,()=>{L("sendImageData",h.value)}),(S,r)=>(y(),x("label",{for:"file-input",class:w(["drop-area",[{"border-netural-800":h.value.isUploaded},{show:h.value.isUploaded}]]),onDrop:r[2]||(r[2]=ae($=>Y($),["prevent"])),onDragover:r[3]||(r[3]=ae(()=>{},["prevent"]))},[e("input",{type:"file",id:"file-input",accept:"image/jpeg, image/png, image/webp",hidden:"",ref_key:"fileInputRef",ref:m,onChange:r[0]||(r[0]=$=>M())},null,544),e("div",{class:"img-view",ref_key:"imgViewRef",ref:P},[f((y(),x("svg",et,st,512)),[[_e,!h.value.isUploaded]]),e("div",{class:w(["tool",{show:h.value.isUploaded}])},[e("div",ot,[e("a",{href:"#",class:"tool-icon",onClick:r[1]||(r[1]=ae($=>Z(),["prevent"]))},it)])],2)],512)],34))}},nt=he(lt,[["__scopeId","data-v-19373216"]]),c=U=>(me("data-v-dd151b26"),U=U(),fe(),U),dt=I+"#plus",ct=I+"#check-circle",rt=I+"#x-circle",ut=I+"#box-arrow-up-right",pt=I+"#trash3",_t=I+"#file-text",mt=I+"#image",ft={class:"card shadow"},ht={class:"card-header d-flex justify-content-between align-items-center py-3"},gt=c(()=>e("h5",{class:"fs-6"},"商品清單",-1)),vt=c(()=>e("svg",{width:"16",height:"16",class:"ms-1"},[e("use",{"xlink:href":dt})],-1)),bt={class:"card-body"},yt={class:"table table-hover table-striped"},xt=c(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"商品標題"),e("th",{scope:"col",class:"text-end"},"類別"),e("th",{scope:"col",class:"text-end"},"酸度"),e("th",{scope:"col",class:"text-end"},"產地"),e("th",{scope:"col",class:"text-end"},"原價(NTD)"),e("th",{scope:"col",class:"text-end"},"售價(NTD)"),e("th",{scope:"col",class:"text-end"},"是否啟用"),e("th",{scope:"col",class:"text-end"},"功能")])],-1)),kt={class:"align-middle"},wt={scope:"row"},Ut={class:"text-end"},Pt={class:"badge rounded-pill text-bg-primary py-2 fw-normal"},Dt={class:"text-end"},At={class:"text-end"},It={class:"text-end"},$t={class:"text-end"},Lt={class:"text-end"},Mt={width:"20",height:"20"},St={key:0,"xlink:href":ct,class:"text-success"},Vt={key:1,"xlink:href":rt,class:"text-danger"},Ct={class:"text-end"},Ft=["onClick"],Tt=c(()=>e("svg",{width:"16",height:"16",class:"d-flex"},[e("use",{"xlink:href":ut})],-1)),zt=[Tt],Nt=["onClick"],Et=c(()=>e("svg",{width:"16",height:"16",class:"d-flex"},[e("use",{"xlink:href":pt})],-1)),Rt=[Et],Bt={"aria-label":"Page navigation example"},jt={class:"pagination"},Gt=c(()=>e("span",{"aria-hidden":"true"},"«",-1)),Kt=[Gt],Ot=["onClick","disabled"],qt=c(()=>e("span",{"aria-hidden":"true"},"»",-1)),Jt=[qt],Wt={class:"modal-dialog"},Xt={class:"modal-content","data-bs-theme":"dark"},Ht={class:"modal-header bg-netural-800 text-netural-100 py-3"},Qt={class:"modal-title fs-6"},Yt=c(()=>e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1)),Zt={class:"modal-body","data-bs-theme":"light"},es=c(()=>e("div",{class:"list-group d-inline-flex flex-row"},[e("a",{href:"#list-content",class:"list-group-item list-group-item-action d-flex align-items-center active","data-bs-toggle":"list"},[e("svg",{width:"18",height:"18"},[e("use",{"xlink:href":_t})]),e("span",{class:"text-nowrap ms-2"},"內容")]),e("a",{href:"#list-images",class:"list-group-item list-group-item-action d-flex align-items-center","data-bs-toggle":"list"},[e("svg",{width:"18",height:"18"},[e("use",{"xlink:href":mt})]),e("span",{class:"text-nowrap ms-2"},"圖片")])],-1)),ts={class:"tab-content"},ss={class:"tab-pane fade show active p-3 border",id:"list-content"},os={action:"#"},as={class:"mb-2"},is={for:"title",class:"form-label fs-8"},ls={class:"text-danger ms-1"},ns={class:"row gx-3 mb-2"},ds={class:"col-4"},cs={for:"category",class:"form-label fs-8"},rs={class:"text-danger ms-1"},us={class:"col-4"},ps={for:"acidity",class:"form-label fs-8"},_s={class:"text-danger ms-1"},ms={class:"col-4"},fs={for:"origin",class:"form-label fs-8"},hs={class:"text-danger ms-1"},gs={class:"row gx-3 mb-2"},vs={class:"col-4"},bs={for:"origin-price",class:"form-label fs-8"},ys={class:"text-danger ms-1"},xs={class:"col-4"},ks={for:"price",class:"form-label fs-8"},ws={class:"text-danger ms-1"},Us={class:"col-4"},Ps={for:"unit",class:"form-label fs-8"},Ds={class:"text-danger ms-1"},As={class:"mb-2"},Is={for:"content",class:"form-label fs-8"},$s={class:"text-danger ms-1"},Ls={class:"mb-2"},Ms={for:"description",class:"form-label fs-8"},Ss={class:"text-danger ms-1"},Vs={class:"form-check form-switch"},Cs=["checked"],Fs=c(()=>e("label",{class:"form-check-label fs-8",for:"isEnable"},"是否啟用",-1)),Ts={class:"tab-pane fade p-3 border",id:"list-images"},zs={class:"row"},Ns={class:"col-3"},Es=c(()=>e("label",{class:"form-label fs-8"},"主要圖片",-1)),Rs={class:"col-9"},Bs={class:"d-flex flex-column h-100"},js={class:"mb-1"},Gs=c(()=>e("p",{class:"fs-8 text-muted"},"限制 : 圖片檔案不可大於 3MB",-1)),Ks=c(()=>e("span",null,null,-1)),Os={class:"mt-auto d-flex justify-content-between"},qs={class:"me-2"},Js={width:"16",height:"16"},Ws=["xlink:href"],Xs=["disabled"],Hs={class:"spinner-border spinner-grow-sm ms-1",role:"status"},Qs=c(()=>e("span",{class:"visually-hidden"},"Loading...",-1)),Ys=[Qs],Zs={class:"modal-footer bg-netural-800"},eo=c(()=>e("button",{type:"button",class:"btn btn-outline-netural-300","data-bs-dismiss":"modal"}," 關閉 ",-1)),to={class:"modal-dialog"},so={class:"modal-content","data-bs-theme":"dark"},oo=c(()=>e("div",{class:"modal-header bg-danger text-netural-100 py-3"},[e("h1",{class:"modal-title fs-6"},"刪除商品"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),ao={class:"modal-body py-4 fs-6"},io={class:"text-bg-danger mx-1 px-1 rounded-1"},lo={class:"modal-footer bg-danger"},no=c(()=>e("button",{type:"button",class:"btn btn-outline-netural-100","data-bs-dismiss":"modal"}," 取消 ",-1)),co={__name:"AdminProducts",setup(U){const Q=Oe(),{apiResAlert:m,apiErrAlert:P}=Q,h=qe(),{isLoadingOn:L,isLoadingOff:M}=h,{fetchUpload:Y,fetchAdminProducts:Z,fetchAddAdminProduct:S,fetchDelAdminProduct:r,fetchUpdateAdminProduct:$}=We(),{productData:ve,pagination:V,isNew:B,tempProdcut:F,getAdminProdcuts:ee,addAdminProduct:be,deleteProdcut:ye,updateProduct:xe}=ke();function ke(){const i=_([]),o=_({}),s=_(!1),k=_({});async function D(u=1){L("isFullLoading");try{const n=await Z(u);i.value=n.data.products,o.value=n.data.pagination}catch(n){P(n.response.data.message)}finally{M("isFullLoading")}}async function N(u){L("isFullLoading");try{const n=await S(u);await D(),m(n.data.message),oe("product")}catch(n){P(n.response.data.message)}finally{M("isFullLoading")}}async function E(u){L("isFullLoading");try{const n=await r(u);await D(),m(n.data.message),oe("delete")}catch(n){P(n.response.data.message)}finally{M("isFullLoading")}}async function a(u,n){L("isFullLoading");try{const R=await $(u,n);await D(),oe("product"),m(R.data.message)}catch(R){P(R.response.data.message)}finally{M("isFullLoading")}}return de(()=>D()),{productData:i,pagination:o,isNew:s,tempProdcut:k,getAdminProdcuts:D,addAdminProduct:N,deleteProdcut:E,updateProduct:a}}const{isLoading:le,imageData:T,sizeCheck:te,formatSize:we,getEmitData:Ue,removeFiledImageUrl:Pe,upload:De}=Ae();function Ae(){const i=_(!1),o=_({isUploaded:!1,viewLink:"",fileName:"",fileSize:0,fileType:"",data:{}}),s=ce(()=>o.value.fileSize>3145728),k=ce(()=>{const a=o.value.fileSize/1024;return a>1024?`${(a/1024).toFixed(2)} MB`:`${a.toFixed(2)} KB`});function D(a){o.value=a}function N(){C.value=""}function E(){const{data:a}=o.value,u=new FormData;u.append("file-to-upload",a),i.value=!0,Y(u).then(n=>{C.value=n.data.imageUrl,m("圖片上傳成功!"),i.value=!1}).catch(n=>{P(n.response.data.message),i.value=!1})}return{isLoading:i,imageData:o,sizeCheck:s,formatSize:k,getEmitData:D,removeFiledImageUrl:N,upload:E}}const{refProductModal:Ie,refDeleteModal:$e,openModal:se,closeModal:oe}=Le();function Le(){const i=_(null),o=_(null),s=_(""),k=_("");function D(a,u){a==="create"?(ne((n,{resetForm:R})=>R())(),B.value=!0,s.value.show()):a==="edit"?(B.value=!1,F.value=u,E(u),s.value.show()):a==="delete"&&(k.value.show(),F.value=u)}function N(a){if(a==="product"){s.value.hide();return}k.value.hide()}function E(a){j.value=a.title,G.value=a.category,K.value=a.acidity,O.value=a.origin,q.value=a.origin_price,J.value=a.price,W.value=a.unit,X.value=a.content,H.value=a.description,z.value=a.is_enabled,C.value=a.imageUrl}return de(()=>{s.value=new pe(i.value),k.value=new pe(o.value)}),{refProductModal:i,refDeleteModal:o,openModal:D,closeModal:N}}const{addProductSchema:Me}=Xe(),{defineField:g,handleSubmit:ne,errors:d}=He({validationSchema:Me}),[j,Se]=g("title"),[G,Ve]=g("category"),[K,Ce]=g("acidity"),[O,Fe]=g("origin"),[q,Te]=g("originPrice"),[J,ze]=g("price"),[W,Ne]=g("unit"),[X,Ee]=g("content"),[H,Re]=g("description"),[z,Be]=g("isEnabled"),[C,je]=g("imageUrl"),Ge=ne(i=>{const o={title:i.title,category:i.category,acidity:i.acidity,origin:i.origin,origin_price:i.originPrice,price:i.price,unit:i.unit,content:i.content,description:i.description,is_enabled:i.isEnabled,imageUrl:i.imageUrl};B.value?be({data:o}):xe(F.value.id,{data:o})});return(i,o)=>(y(),x(ie,null,[re(Qe),e("div",ft,[e("div",ht,[gt,e("button",{type:"button",class:"btn btn-sm btn-primary rounded-0 d-flex align-items-center",onClick:o[0]||(o[0]=s=>t(se)("create"))},[p(" 新增產品 "),vt])]),e("div",bt,[e("table",yt,[xt,e("tbody",kt,[(y(!0),x(ie,null,ue(t(ve),s=>(y(),x("tr",{key:s.id},[e("td",wt,l(s.title),1),e("td",Ut,[e("span",Pt,l(s.category),1)]),e("td",Dt,l(s.acidity),1),e("td",At,l(s.origin),1),e("td",It,l(s.origin_price),1),e("td",$t,l(s.price),1),e("td",Lt,[(y(),x("svg",Mt,[s.is_enabled?(y(),x("use",St)):(y(),x("use",Vt))]))]),e("td",Ct,[e("button",{type:"button",class:"btn btn-netural-800 rounded-1 py-1 px-2",onClick:k=>t(se)("edit",s)},zt,8,Ft),e("button",{type:"button",class:"btn btn-danger rounded-1 py-1 px-2 ms-1",onClick:k=>t(se)("delete",s)},Rt,8,Nt)])]))),128))])]),e("nav",Bt,[e("ul",jt,[e("li",{class:w(["page-item",{"d-none":t(V).has_pre===!1}])},[e("button",{type:"button",class:"page-link",onClick:o[1]||(o[1]=s=>t(ee)(t(V).current_page-1))},Kt)],2),(y(!0),x(ie,null,ue(t(V).total_pages,s=>(y(),x("li",{key:s+123,class:w(["page-item",{active:t(V).current_page===s}])},[e("button",{class:"page-link",type:"button",onClick:k=>t(ee)(s),disabled:t(V).current_page===s},l(s),9,Ot)],2))),128)),e("li",{class:w(["page-item",{"d-none":t(V).has_next===!1}])},[e("button",{type:"button",class:"page-link",onClick:o[2]||(o[2]=s=>t(ee)(t(V).current_page+1))},Jt)],2)])])])]),e("div",{class:"modal fade",id:"productModal",ref_key:"refProductModal",ref:Ie},[e("div",Wt,[e("div",Xt,[e("div",Ht,[e("h1",Qt,l(t(B)?"新增商品":"修改商品"),1),Yt]),e("div",Zt,[es,e("div",ts,[e("div",ss,[e("form",os,[e("div",as,[e("label",is,[p("商品標題"),e("span",ls,l(t(d).title),1)]),f(e("input",v({type:"text",class:["form-control form-control-sm",{"is-invalid":t(d).title}],id:"title",placeholder:"請輸入商品標題","onUpdate:modelValue":o[3]||(o[3]=s=>b(j)?j.value=s:null)},t(Se)),null,16),[[A,t(j)]])]),e("div",ns,[e("div",ds,[e("label",cs,[p("類別"),e("span",rs,l(t(d).category),1)]),f(e("input",v({type:"text",class:["form-control form-control-sm",{"is-invalid":t(d).category}],id:"category",placeholder:"請輸入類別","onUpdate:modelValue":o[4]||(o[4]=s=>b(G)?G.value=s:null)},t(Ve)),null,16),[[A,t(G)]])]),e("div",us,[e("label",ps,[p("酸度"),e("span",_s,l(t(d).acidity),1)]),f(e("input",v({type:"number",class:["form-control form-control-sm",{"is-invalid":t(d).acidity}],id:"acidity",placeholder:"請輸入類別","onUpdate:modelValue":o[5]||(o[5]=s=>b(K)?K.value=s:null)},t(Ce)),null,16),[[A,t(K)]])]),e("div",ms,[e("label",fs,[p("產地"),e("span",hs,l(t(d).origin),1)]),f(e("input",v({type:"text",class:["form-control form-control-sm",{"is-invalid":t(d).origin}],id:"origin",placeholder:"請輸入類別","onUpdate:modelValue":o[6]||(o[6]=s=>b(O)?O.value=s:null)},t(Fe)),null,16),[[A,t(O)]])])]),e("div",gs,[e("div",vs,[e("label",bs,[p("原價"),e("span",ys,l(t(d).originPrice),1)]),f(e("input",v({type:"number",class:["form-control form-control-sm",{"is-invalid":t(d).originPrice}],id:"origin-price",placeholder:"請輸入原價","onUpdate:modelValue":o[7]||(o[7]=s=>b(q)?q.value=s:null)},t(Te)),null,16),[[A,t(q)]])]),e("div",xs,[e("label",ks,[p("售價"),e("span",ws,l(t(d).price),1)]),f(e("input",v({type:"number",class:["form-control form-control-sm",{"is-invalid":t(d).price}],id:"price",placeholder:"請輸入售價","onUpdate:modelValue":o[8]||(o[8]=s=>b(J)?J.value=s:null)},t(ze)),null,16),[[A,t(J)]])]),e("div",Us,[e("label",Ps,[p("單位"),e("span",Ds,l(t(d).unit),1)]),f(e("input",v({type:"text",class:["form-control form-control-sm",{"is-invalid":t(d).unit}],id:"unit",placeholder:"請輸入單位","onUpdate:modelValue":o[9]||(o[9]=s=>b(W)?W.value=s:null)},t(Ne)),null,16),[[A,t(W)]])])]),e("div",As,[e("label",Is,[p("內容"),e("span",$s,l(t(d).content),1)]),f(e("input",v({type:"text",class:["form-control form-control-sm",{"is-invalid":t(d).content}],id:"content",placeholder:"請輸入商品內容","onUpdate:modelValue":o[10]||(o[10]=s=>b(X)?X.value=s:null)},t(Ee)),null,16),[[A,t(X)]])]),e("div",Ls,[e("label",Ms,[p("描述"),e("span",Ss,l(t(d).description),1)]),f(e("textarea",v({class:["form-control form-control-sm",{"is-invalid":t(d).description}],id:"description",rows:"3",placeholder:"請輸入商品描述","onUpdate:modelValue":o[11]||(o[11]=s=>b(H)?H.value=s:null)},t(Re)),null,16),[[A,t(H)]])]),e("div",Vs,[f(e("input",v({class:"form-check-input",type:"checkbox",id:"isEnable",checked:t(z),"onUpdate:modelValue":o[12]||(o[12]=s=>b(z)?z.value=s:null)},t(Be)),null,16,Cs),[[Je,t(z)]]),Fs])])]),e("div",Ts,[e("div",zs,[e("div",Ns,[e("div",null,[Es,re(nt,v({onSendImageData:t(Ue),onRemoveImageData:t(Pe),modelValue:t(C),"onUpdate:modelValue":o[13]||(o[13]=s=>b(C)?C.value=s:null)},t(je)),null,16,["onSendImageData","onRemoveImageData","modelValue"])])]),e("div",Rs,[e("div",Bs,[e("div",null,[e("h5",{class:w(["fs-8 lh-base mb-2",{"text-danger":t(te)}])}," 檔名 : "+l(t(T).fileName),3),e("div",js,[e("span",{class:w(["badge text-bg-netural-900",{"bg-success":t(T).fileType==="jpeg"}])},"JPG",2),e("span",{class:w(["badge text-bg-netural-900 ms-1",{"bg-success":t(T).fileType==="png"}])},"PNG",2),e("span",{class:w(["badge text-bg-netural-900 ms-1",{"bg-success":t(T).fileType==="webp"}])},"WEBP",2)]),Gs,Ks]),e("div",Os,[e("div",{class:w(["d-flex align-items-center text-success",{"text-danger":t(te)}])},[e("span",qs,l(t(we)),1),(y(),x("svg",Js,[e("use",{"xlink:href":`/public/icons/icons.svg#${t(te)?"x-circle":"check-circle"}`},null,8,Ws)]))],2),e("button",{type:"button",class:"btn btn-sm btn-success",onClick:o[14]||(o[14]=s=>t(De)()),disabled:!t(T).isUploaded||t(le)},[p(" 點擊上傳 "),f(e("div",Hs,Ys,512),[[_e,t(le)]])],8,Xs)])])])])])])]),e("div",Zs,[eo,e("button",{type:"button",class:"btn btn-success",onClick:o[15]||(o[15]=s=>t(Ge)())},"儲存")])])])],512),e("div",{class:"modal fade",id:"exampleModal",ref_key:"refDeleteModal",ref:$e},[e("div",to,[e("div",so,[oo,e("div",ao,[p(" 確認刪除"),e("span",io,l(t(F).title),1),p("商品 ? ")]),e("div",lo,[no,e("button",{type:"button",class:"btn btn-netural-900",onClick:o[16]||(o[16]=s=>t(ye)(t(F).id))}," 確認刪除 ")])])])],512)],64))}},ho=he(co,[["__scopeId","data-v-dd151b26"]]);export{ho as default};
